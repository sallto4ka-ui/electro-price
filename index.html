<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–∞–∂ 2025</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #838383;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f2f5;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
            padding-bottom: 90px; /* –£–≤–µ–ª–∏—á–∏–ª –æ—Ç—Å—Ç—É–ø, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª—Å—è –º–µ–Ω—é */
            overflow-x: hidden;
        }

        /* === –≠–ö–†–ê–ù–´ === */
        .tab-screen { display: none; }
        .tab-screen.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* === –®–ê–ü–ö–ê === */
        .header { background-color: var(--tg-theme-bg-color); padding: 15px; margin-bottom: 10px; }
        .header h1 { margin: 0; font-size: 22px; font-weight: 800; }
        .header p { margin: 5px 0 0; font-size: 13px; color: var(--tg-theme-hint-color); }

        /* === –ù–ê–í–ò–ì–ê–¶–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ô === */
        .nav-cats {
            position: sticky; top: 0; z-index: 100; background-color: var(--tg-theme-bg-color);
            display: flex; overflow-x: auto; padding: 10px 15px; gap: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); scrollbar-width: none;
        }
        .nav-cats::-webkit-scrollbar { display: none; }

        .cat-btn {
            white-space: nowrap; padding: 8px 16px; border-radius: 20px;
            background-color: var(--tg-theme-secondary-bg-color); color: var(--tg-theme-text-color);
            font-size: 13px; font-weight: 500; border: none; cursor: pointer; transition: 0.2s;
        }
        .cat-btn.active { background-color: var(--tg-theme-button-color); color: var(--tg-theme-button-text-color); }

        /* === –°–ü–ò–°–û–ö –£–°–õ–£–ì === */
        .content { padding: 15px; }
        .section-title { font-size: 18px; font-weight: 700; margin: 25px 0 10px; }

        .card {
            background-color: var(--tg-theme-bg-color); border-radius: 16px; padding: 12px 16px;
            margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .card-info { flex: 1; padding-right: 10px; }
        .card-title { font-size: 15px; font-weight: 500; margin-bottom: 6px; }
        .card-price { font-size: 14px; font-weight: 700; }
        .card-unit { font-size: 12px; font-weight: 400; color: var(--tg-theme-hint-color); }

        /* === –≠–õ–ï–ú–ï–ù–¢–´ –°–ú–ï–¢–´ === */
        .estimate-empty { text-align: center; padding: 50px 20px; color: var(--tg-theme-hint-color); }
        
        .estimate-total {
            background: var(--tg-theme-bg-color); padding: 20px; border-radius: 16px; margin: 15px;
            text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .total-sum { font-size: 32px; font-weight: 800; color: var(--tg-theme-button-color); margin: 5px 0; }

        /* === –ü–û–õ–ï –ö–û–ú–ú–ï–ù–¢–ê–†–ò–Ø === */
        .input-block {
            background: var(--tg-theme-bg-color); border-radius: 16px; padding: 15px; margin: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .input-label { font-size: 13px; font-weight: 600; color: var(--tg-theme-hint-color); margin-bottom: 10px; display: block; }
        .text-input {
            width: 100%; border: 1px solid #e0e0e0; background: var(--tg-theme-secondary-bg-color);
            border-radius: 12px; padding: 12px; font-size: 16px; color: var(--tg-theme-text-color);
            resize: none; outline: none; box-sizing: border-box; font-family: inherit;
        }
        .text-input:focus { border-color: var(--tg-theme-button-color); }

        /* === –ì–õ–ê–í–ù–ê–Ø –ö–ù–û–ü–ö–ê (–í–ù–£–¢–†–ò –°–¢–†–ê–ù–ò–¶–´) === */
        .main-action-btn {
            width: calc(100% - 30px); margin: 0 15px 20px 15px; padding: 18px;
            background-color: var(--tg-theme-button-color); color: var(--tg-theme-button-text-color);
            border: none; border-radius: 14px; font-size: 16px; font-weight: 700; cursor: pointer;
            text-align: center; box-shadow: 0 4px 12px rgba(36, 129, 204, 0.3);
            display: block; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫–æ–º */
        }
        .main-action-btn:active { transform: scale(0.98); opacity: 0.9; }

        /* === –ö–†–ï–°–¢–ò–ö –£–î–ê–õ–ï–ù–ò–Ø === */
        .btn-delete {
            background: rgba(255, 59, 48, 0.1); color: #ff3b30; width: 32px; height: 32px;
            border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; cursor: pointer;
        }

        /* === –ö–û–ù–¢–†–û–õ–õ–ï–†–´ === */
        .stepper { display: flex; align-items: center; background: var(--tg-theme-secondary-bg-color); border-radius: 12px; height: 36px; }
        .step-btn { width: 32px; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: var(--tg-theme-button-color); cursor: pointer; }
        .step-val { min-width: 24px; text-align: center; font-size: 15px; font-weight: 600; }
        .add-btn { height: 36px; padding: 0 14px; background-color: var(--tg-theme-secondary-bg-color); color: var(--tg-theme-button-color); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 13px; cursor: pointer; }

        /* === –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ === */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0; height: 60px;
            background-color: var(--tg-theme-bg-color); border-top: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-around; align-items: center; z-index: 500;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--tg-theme-hint-color); font-size: 11px; font-weight: 500; cursor: pointer; }
        .nav-item.active { color: var(--tg-theme-button-color); }
        .nav-icon { font-size: 22px; margin-bottom: 2px; }
        .badge { position: absolute; top: 5px; margin-left: 15px; background: #ff3b30; color: white; font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 10px; display: none; }
        .badge.visible { display: inline-block; }
    </style>
</head>
<body>

    <!-- –≠–ö–†–ê–ù 1: –ö–ê–¢–ê–õ–û–ì -->
    <div id="screen-catalog" class="tab-screen active">
        <div class="header">
            <h1>‚ö°–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å –≠–ª–µ–∫—Ç—Ä–æ‚ö°</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</p>
        </div>
        <div class="nav-cats" id="nav-cats"></div>
        <div class="content" id="catalog-list"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 2: –°–ú–ï–¢–ê -->
    <div id="screen-estimate" class="tab-screen">
        <div class="header">
            <h1>–í–∞—à–∞ —Å–º–µ—Ç–∞ üìù</h1>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞—è–≤–∫—É</p>
        </div>

        <div id="estimate-content">
            <!-- –°—é–¥–∞ JS –≤—Å—Ç–∞–≤–∏—Ç —Å–ø–∏—Å–æ–∫ -->
        </div>
        
        <!-- –ë–ª–æ–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–ø–æ—è–≤–∏—Ç—Å—è, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã) -->
        <div id="order-block" style="display:none;">
            <!-- –ü–æ–ª–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            <div class="input-block">
                <label class="input-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É (–ê–¥—Ä–µ—Å, –¢–µ–ª–µ—Ñ–æ–Ω, –í—Ä–µ–º—è):</label>
                <textarea id="order-comment" class="text-input" rows="3" placeholder="–ü—Ä–∏–º–µ—Ä: —É–ª. –õ–µ–Ω–∏–Ω–∞ 5, –∫–≤ 10. –£–¥–æ–±–Ω–æ –≤ —Å—É–±–±–æ—Ç—É..."></textarea>
            </div>
            
            <!-- –ë–æ–ª—å—à–∞—è –∫–Ω–æ–ø–∫–∞ -->
            <button class="main-action-btn" onclick="sendOrder()">
                –û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£ –í WHATSAPP
            </button>
        </div>
    </div>

    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
    <div class="bottom-bar">
        <div class="nav-item active" onclick="switchTab('catalog')">
            <div class="nav-icon">üìã</div>
            <div>–ö–∞—Ç–∞–ª–æ–≥</div>
        </div>
        <div class="nav-item" onclick="switchTab('estimate')" style="position: relative;">
            <div class="nav-icon">üí∞</div>
            <div>–°–º–µ—Ç–∞</div>
            <div class="badge" id="cart-badge">0</div>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    const themeParams = tg.themeParams;
    const btnColor = themeParams.button_color || "#2481cc";
    const btnText = themeParams.button_text_color || "#ffffff";
    
    tg.MainButton.textColor = btnText;
    tg.MainButton.color = btnColor;

    // –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ö–ù–û–ü–ö–ò –í CSS –ß–ï–†–ï–ó JS (–¥–ª—è —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã)
    document.documentElement.style.setProperty('--tg-theme-button-color', btnColor);
    document.documentElement.style.setProperty('--tg-theme-button-text-color', btnText);

    // == –ë–ê–ó–ê –î–ê–ù–ù–´–• ==
    const database = [
        {
            id: "finish",
            title: "–ß–∏—Å—Ç–æ–≤–∞—è —ç–ª–µ–∫—Ç—Ä–∏–∫–∞",
            items: [
                { id: 1, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–∑–µ—Ç–∫–∏ / –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—è (–≤ –ø–æ–¥—Ä–æ–∑–µ—Ç–Ω–∏–∫)", price: 350, unit: "—à—Ç" },
                { id: 2, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–∫–ª–∞–¥–Ω–æ–π —Ä–æ–∑–µ—Ç–∫–∏ (–æ—Ç–∫—Ä—ã—Ç–∞—è)", price: 450, unit: "—à—Ç" },
                { id: 3, name: "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–∞—Ä–æ—á–Ω–æ–π –ø–∞–Ω–µ–ª–∏ (1—Ñ/3—Ñ)", price: 1200, unit: "—à—Ç" },
                { id: 4, name: "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥—É—Ö. —à–∫–∞—Ñ–∞", price: 1000, unit: "—à—Ç" },
                { id: 5, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏–ª–æ–≤–æ–π —Ä–æ–∑–µ—Ç–∫–∏ 380–í (3 —Ñ–∞–∑—ã)", price: 1500, unit: "—à—Ç" },
                { id: 6, name: "–ú–æ–Ω—Ç–∞–∂ —Ç–µ—Ä–º–æ—Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞ —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞", price: 600, unit: "—à—Ç" }
            ]
        },
        {
            id: "light",
            title: "–û—Å–≤–µ—â–µ–Ω–∏–µ & LED",
            items: [
                { id: 10, name: "–ú–æ–Ω—Ç–∞–∂ –ª—é—Å—Ç—Ä—ã (–∫—Ä—é–∫/–ø–ª–∞–Ω–∫–∞)", price: 1500, unit: "—à—Ç" },
                { id: 11, name: "–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ '–ê—Ä–º—Å—Ç—Ä–æ–Ω–≥' / –û—Ñ–∏—Å–Ω—ã–π", price: 500, unit: "—à—Ç" },
                { id: 12, name: "–¢–æ—á–µ—á–Ω—ã–π —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫ (–≤—Ä–µ–∑–∫–∞+–ø–æ–¥–∫–ª.)", price: 450, unit: "—à—Ç" },
                { id: 13, name: "LED –ª–µ–Ω—Ç–∞ (–º–æ–Ω—Ç–∞–∂ –≤ –ø—Ä–æ—Ñ–∏–ª—å)", price: 450, unit: "–º" },
                { id: 14, name: "LED –ª–µ–Ω—Ç–∞ (–Ω–∞–∫–ª–µ–π–∫–∞)", price: 300, unit: "–º" },
                { id: 15, name: "–ú–æ–Ω—Ç–∞–∂ –±–ª–æ–∫–∞ –ø–∏—Ç–∞–Ω–∏—è / –¥—Ä–∞–π–≤–µ—Ä–∞", price: 800, unit: "—à—Ç" }
            ]
        },
        {
            id: "diag",
            title: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",
            items: [
                { id: 20, name: "–ü–æ–∏—Å–∫ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏ (–º–∏–Ω. –≤—ã–µ–∑–¥)", price: 3000, unit: "—É—Å–ª." },
                { id: 21, name: "–†–µ–º–æ–Ω—Ç –æ–±—Ä—ã–≤–∞ –≤ —Å—Ç–µ–Ω–µ (–±–µ–∑ –æ—Ç–¥–µ–ª–∫–∏)", price: 1500, unit: "—Ç–æ—á–∫–∞" },
                { id: 22, name: "–ü–µ—Ä–µ–±–æ—Ä–∫–∞ —Ä–∞—Å–ø–∞–µ—á–Ω–æ–π –∫–æ—Ä–æ–±–∫–∏", price: 1200, unit: "—à—Ç" }
            ]
        },
        {
            id: "rough",
            title: "–ß–µ—Ä–Ω–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã",
            items: [
                { id: 30, name: "–®—Ç—Ä–æ–±–ª–µ–Ω–∏–µ (–±–µ—Ç–æ–Ω)", price: 600, unit: "–º" },
                { id: 31, name: "–®—Ç—Ä–æ–±–ª–µ–Ω–∏–µ (–∫–∏—Ä–ø–∏—á/–±–ª–æ–∫)", price: 400, unit: "–º" },
                { id: 32, name: "–í–º–∞–∑–∫–∞ –ø–æ–¥—Ä–æ–∑–µ—Ç–Ω–∏–∫–∞", price: 350, unit: "—à—Ç" },
                { id: 33, name: "–ü—Ä–æ–∫–ª–∞–¥–∫–∞ –∫–∞–±–µ–ª—è (–≤ –≥–æ—Ñ—Ä–µ)", price: 150, unit: "–º" }
            ]
        },
        {
            id: "shield",
            title: "–©–∏—Ç –∏ –ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞",
            items: [
                { id: 40, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∞ 1–ü", price: 350, unit: "—à—Ç" },
                { id: 41, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –£–ó–û / –î–∏—Ñ.–∞–≤—Ç–æ–º–∞—Ç–∞", price: 600, unit: "—à—Ç" },
                { id: 42, name: "–ö—Ä–æ—Å—Å-–º–æ–¥—É–ª—å / –®–∏–Ω—ã", price: 800, unit: "—à—Ç" },
                { id: 43, name: "–ú–æ–Ω—Ç–∞–∂ —Å—á–µ—Ç—á–∏–∫–∞", price: 1500, unit: "—à—Ç" }
            ]
        }
    ];

    let cart = {};
    let currentTab = 'catalog';

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    function init() {
        const catContainer = document.getElementById('nav-cats');
        const listContainer = document.getElementById('catalog-list');

        database.forEach((cat, index) => {
            // –ö–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const btn = document.createElement('button');
            btn.className = `cat-btn ${index === 0 ? 'active' : ''}`;
            btn.innerText = cat.title;
            btn.onclick = () => {
                document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(`cat-${cat.id}`).scrollIntoView({ behavior: 'smooth', block: 'start' });
            };
            catContainer.appendChild(btn);

            // –°–µ–∫—Ü–∏–∏
            const section = document.createElement('div');
            section.id = `cat-${cat.id}`;
            section.innerHTML = `<div class="section-title">${cat.title}</div>`;
            
            cat.items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-info">
                        <div class="card-title">${item.name}</div>
                        <div class="card-price">${item.price} ‚ÇΩ <span class="card-unit">/ ${item.unit}</span></div>
                    </div>
                    <div id="ctrl-${item.id}">
                        ${renderControl(item.id)}
                    </div>
                `;
                section.appendChild(card);
            });
            listContainer.appendChild(section);
        });
    }

    // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò ===
    window.switchTab = function(tabName) {
        currentTab = tabName;
        document.querySelectorAll('.tab-screen').forEach(s => s.classList.remove('active'));
        document.getElementById(`screen-${tabName}`).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        const navIndex = tabName === 'catalog' ? 0 : 1;
        document.querySelectorAll('.nav-item')[navIndex].classList.add('active');

        if (tabName === 'estimate') renderEstimate();
        updateMainButton();
    }

    // === –û–¢–†–ò–°–û–í–ö–ê –°–ú–ï–¢–´ ===
    function renderEstimate() {
        const container = document.getElementById('estimate-content');
        const orderBlock = document.getElementById('order-block');
        let total = 0;
        let html = '';
        let hasItems = false;

        database.forEach(cat => {
            cat.items.forEach(item => {
                if (cart[item.id] > 0) {
                    hasItems = true;
                    const sum = cart[item.id] * item.price;
                    total += sum;
                    html += `
                    <div class="card">
                        <div class="card-info">
                            <div class="card-title">${item.name}</div>
                            <div class="card-price">${cart[item.id]} ${item.unit} √ó ${item.price} = <b>${sum} ‚ÇΩ</b></div>
                        </div>
                        <div class="btn-delete" onclick="removeItem(${item.id})">‚úï</div>
                    </div>`;
                }
            });
        });

        if (!hasItems) {
            container.innerHTML = `<div class="estimate-empty">
                <h3>–°–º–µ—Ç–∞ –ø—É—Å—Ç–∞ üòï</h3>
                <p>–î–æ–±–∞–≤—å—Ç–µ —É—Å–ª—É–≥–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</p>
            </div>`;
            orderBlock.style.display = 'none';
        } else {
            const totalBlock = `
            <div class="estimate-total">
                <div style="font-size:13px; color:#888;">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</div>
                <div class="total-sum">${total.toLocaleString('ru-RU')} ‚ÇΩ</div>
            </div>`;
            container.innerHTML = totalBlock + '<div class="content">' + html + '</div>';
            orderBlock.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∏ –∫–Ω–æ–ø–∫—É
        }
    }

    // === –õ–û–ì–ò–ö–ê ===
    function renderControl(id) {
        const qty = cart[id] || 0;
        if (qty === 0) return `<div class="add-btn" onclick="update(${id}, 1)">–î–æ–±–∞–≤–∏—Ç—å</div>`;
        return `
            <div class="stepper">
                <div class="step-btn" onclick="update(${id}, -1)">‚àí</div>
                <div class="step-val">${qty}</div>
                <div class="step-btn" onclick="update(${id}, 1)">+</div>
            </div>`;
    }

    window.update = function(id, delta) {
        tg.HapticFeedback.impactOccurred('light');
        if (!cart[id]) cart[id] = 0;
        cart[id] += delta;
        if (cart[id] <= 0) delete cart[id];

        const ctrl = document.getElementById(`ctrl-${id}`);
        if (ctrl) ctrl.innerHTML = renderControl(id);

        if (currentTab === 'estimate') renderEstimate();
        updateMainButton();
        updateBadge();
    };

    window.removeItem = function(id) {
        tg.HapticFeedback.notificationOccurred('warning');
        delete cart[id];
        const ctrl = document.getElementById(`ctrl-${id}`);
        if (ctrl) ctrl.innerHTML = renderControl(id);
        renderEstimate();
        updateMainButton();
        updateBadge();
    }

    function updateBadge() {
        const count = Object.values(cart).reduce((a, b) => a + b, 0);
        const badge = document.getElementById('cart-badge');
        badge.innerText = count;
        if (count > 0) badge.classList.add('visible'); else badge.classList.remove('visible');
    }

    function updateMainButton() {
        let total = 0;
        database.forEach(cat => cat.items.forEach(i => {
            if (cart[i.id]) total += cart[i.id] * i.price;
        }));

        if (total === 0) {
            tg.MainButton.hide();
            return;
        }

        // –°–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ Telegram (–¥—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
        if (currentTab === 'catalog') {
            tg.MainButton.setText(`–í –ö–û–†–ó–ò–ù–£: ${total.toLocaleString()} ‚ÇΩ`);
            tg.MainButton.show();
            tg.MainButton.onClick(() => switchTab('estimate'));
        } else {
            tg.MainButton.setText(`–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£`);
            tg.MainButton.show();
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏ –∏ —Å—Ç–∞–≤–∏–º –Ω–æ–≤—ã–π
            tg.MainButton.offClick(switchTab); 
            tg.MainButton.onClick(sendOrder);
        }
    }

    
  // === –û–¢–ü–†–ê–í–ö–ê –ó–ê–ö–ê–ó–ê –í TELEGRAM (–õ–ò–ß–ö–£) ===
    window.sendOrder = function() {
        const comment = document.getElementById('order-comment').value;
        
        let msg = "‚ö° –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–∞–∂:\n\n";
        let total = 0;
        database.forEach(cat => {
            const items = cat.items.filter(i => cart[i.id]);
            if (items.length) {
                msg += `üîπ ${cat.title}:\n`;
                items.forEach(i => {
                    const sum = cart[i.id] * i.price;
                    total += sum;
                    msg += `- ${i.name}: ${cart[i.id]} ${i.unit} (${sum}‚ÇΩ)\n`;
                });
            }
        });
        
        msg += `\nüí∞ –ò–¢–û–ì–û: ${total.toLocaleString()} —Ä—É–±.`;
        
        if (comment) {
            msg += `\n\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞:\n${comment}`;
        }
        
        // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
        // –í–ø–∏—à–∏—Ç–µ —Å—é–¥–∞ –≤–∞—à –ù–ò–ö –≤ Telegram (–±–µ–∑ —Å–æ–±–∞—á–∫–∏ @)
        // –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤–∞—à –Ω–∏–∫ @electric_master, –ø–∏—à–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ "electric_master"
        const myUsername = "Llosta"; 
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É
        const url = `https://t.me/${myUsername}?text=${encodeURIComponent(msg)}`;
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –≤–∞–º–∏
        tg.close();
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ Telegram –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Å—ã–ª–æ–∫ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        tg.openTelegramLink(url);
    }

    init();
</script>
</body>
</html>
