<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–≠–ª–µ–∫—Ç—Ä–æ–ü—Ä–æ—Ñ–∏ App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- –ò–∫–æ–Ω–∫–∏ –∏ –®—Ä–∏—Ñ—Ç—ã -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* –¶–≤–µ—Ç–∞ –∏–∑ —Ç–µ–º—ã Telegram */
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-link: var(--tg-theme-link-color, #2481cc);
            --tg-btn: var(--tg-theme-button-color, #2481cc);
            --tg-btn-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-sec-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);

            /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ */
            --radius: 16px;
            --shadow: 0 4px 20px rgba(0,0,0,0.05);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: 1px solid rgba(255, 255, 255, 0.5);
            --anim: 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ - –∫–æ—Ä—Ä–µ–∫—Ü–∏—è */
        body.dark-mode {
            --glass-bg: rgba(30, 30, 30, 0.85);
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: 'Inter', sans-serif;
            background: var(--tg-sec-bg);
            color: var(--tg-text);
            padding-bottom: 100px; /* –ú–µ—Å—Ç–æ –ø–æ–¥ –∫–Ω–æ–ø–∫—É */
            overflow-x: hidden;
        }

        /* === –§–û–ù–û–í–´–ï –ü–Ø–¢–ù–ê (–ì—Ä–∞–¥–∏–µ–Ω—Ç) === */
        .blob {
            position: fixed; width: 300px; height: 300px;
            background: var(--tg-btn); opacity: 0.15;
            filter: blur(90px); border-radius: 50%; z-index: -1;
            animation: float 10s infinite ease-in-out;
        }
        .blob-1 { top: -100px; left: -100px; }
        .blob-2 { bottom: -100px; right: -100px; animation-delay: -5s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(30px, 50px); } }

        /* === HEADER === */
        .header { padding: 20px 20px 10px 20px; }
        .header h1 { margin: 0; font-size: 26px; font-weight: 800; line-height: 1.1; }
        .header p { margin: 6px 0 0; color: var(--tg-hint); font-size: 14px; }

        /* === SEARCH === */
        .search-wrap { padding: 0 20px 15px 20px; position: sticky; top: 0; z-index: 90; background: var(--tg-sec-bg); }
        .search-box {
            position: relative; width: 100%;
        }
        .search-input {
            width: 100%; padding: 12px 15px 12px 45px;
            border-radius: 14px; border: none; outline: none;
            background: var(--tg-bg); color: var(--tg-text);
            font-size: 15px; box-shadow: var(--shadow);
            transition: var(--anim);
        }
        .search-input:focus { box-shadow: 0 0 0 2px var(--tg-btn); }
        .search-icon {
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            color: var(--tg-hint);
        }

        /* === TABS (Categories) === */
        .tabs-wrap {
            padding: 5px 20px 15px 20px; display: flex; gap: 10px;
            overflow-x: auto; scrollbar-width: none;
            position: sticky; top: 55px; z-index: 89;
            background: var(--tg-sec-bg); /* –ü–æ–¥–ª–æ–∂–∫–∞, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ—Å–≤–µ—á–∏–≤–∞–ª–æ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ */
            mask-image: linear-gradient(90deg, #000 90%, transparent); /* Fade effect —Å–ø—Ä–∞–≤–∞ */
        }
        .tabs-wrap::-webkit-scrollbar { display: none; }

        .tab-btn {
            padding: 8px 16px; border-radius: 20px;
            background: var(--tg-bg); color: var(--tg-text);
            font-size: 13px; font-weight: 600; white-space: nowrap;
            border: 1px solid transparent; box-shadow: var(--shadow);
            display: flex; align-items: center; gap: 6px;
            transition: var(--anim); opacity: 0.8;
        }
        .tab-btn.active {
            background: var(--tg-btn); color: var(--tg-btn-text);
            opacity: 1; transform: scale(1.05);
        }

        /* === LIST === */
        .list-wrap { padding: 0 20px; }
        .category-block { margin-bottom: 25px; }
        .cat-title { font-size: 18px; font-weight: 700; margin-bottom: 12px; padding-left: 5px; }

        .item-card {
            background: var(--tg-bg);
            border-radius: var(--radius);
            padding: 15px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: var(--shadow); border: 1px solid transparent;
            transition: var(--anim);
        }
        .item-card.has-qty {
            border-color: var(--tg-btn);
            background: rgba(36, 129, 204, 0.05); /* –õ–µ–≥–∫–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
        }
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
        body.dark-mode .item-card.has-qty { background: rgba(36, 129, 204, 0.15); }

        .item-info { flex: 1; padding-right: 15px; }
        .item-name { font-size: 15px; font-weight: 500; margin-bottom: 4px; line-height: 1.3; }
        .item-price { font-size: 14px; font-weight: 700; color: var(--tg-text); }
        .item-unit { font-size: 12px; color: var(--tg-hint); font-weight: 400; }

        /* CONTROLS (+ / -) */
        .ctrl { display: flex; align-items: center; gap: 0; background: var(--tg-sec-bg); border-radius: 12px; padding: 2px; }
        .ctrl-btn {
            width: 32px; height: 32px; border: none; background: transparent;
            color: var(--tg-btn); font-size: 18px; font-weight: 600;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; border-radius: 8px;
        }
        .ctrl-btn:active { background: rgba(0,0,0,0.1); }
        .ctrl-val { width: 28px; text-align: center; font-size: 14px; font-weight: 600; }
        
        .add-btn {
            background: var(--tg-sec-bg); color: var(--tg-btn);
            padding: 8px 14px; border-radius: 12px; font-weight: 600; font-size: 13px;
        }

        /* === BOTTOM PANEL === */
        .bottom-panel {
            position: fixed; bottom: 20px; left: 15px; right: 15px;
            background: var(--glass-bg);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: var(--glass-border);
            border-radius: 20px; padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 100;
            transform: translateY(150%); transition: var(--anim);
        }
        .bottom-panel.visible { transform: translateY(0); }

        .total-col { display: flex; flex-direction: column; }
        .total-lbl { font-size: 11px; color: var(--tg-hint); text-transform: uppercase; font-weight: 700; }
        .total-val { font-size: 20px; font-weight: 800; color: var(--tg-text); }

        .order-btn {
            background: var(--tg-btn); color: var(--tg-btn-text);
            border: none; padding: 12px 24px; border-radius: 14px;
            font-weight: 600; font-size: 15px;
            display: flex; align-items: center; gap: 8px;
            cursor: pointer; transition: 0.2s;
        }
        .order-btn:active { transform: scale(0.96); }

        /* === MODAL === */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
            z-index: 200; opacity: 0; visibility: hidden; transition: var(--anim);
            display: flex; align-items: flex-end;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        
        .modal-card {
            background: var(--tg-bg); width: 100%;
            border-radius: 24px 24px 0 0; padding: 25px;
            transform: translateY(100%); transition: var(--anim);
            max-height: 85vh; overflow-y: auto;
        }
        .modal-overlay.active .modal-card { transform: translateY(0); }

        .modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-size: 22px; font-weight: 800; }
        
        .cart-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; border-bottom: 1px solid var(--tg-sec-bg); padding-bottom: 8px; }
        
        .input-area {
            width: 100%; background: var(--tg-sec-bg);
            border: 1px solid transparent; border-radius: 16px;
            padding: 15px; color: var(--tg-text); font-family: inherit;
            margin: 20px 0; font-size: 15px; outline: none; resize: none;
        }
        .input-area:focus { border-color: var(--tg-btn); }

        .send-btn {
            width: 100%; padding: 16px; border-radius: 16px;
            background: var(--tg-btn); color: var(--tg-btn-text);
            border: none; font-size: 16px; font-weight: 700;
            display: flex; justify-content: center; gap: 10px; cursor: pointer;
        }

    </style>
</head>
<body>

    <!-- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –ø—è—Ç–Ω–∞ -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="header">
        <h1>–≠–ª–µ–∫—Ç—Ä–æ–ü—Ä–æ—Ñ–∏</h1>
        <p>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —É—Å–ª—É–≥ ‚Ä¢ –ü—Ä–∞–π—Å 2025</p>
    </div>

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-wrap">
        <div class="search-box">
            <i class="fa-solid fa-magnifying-glass search-icon"></i>
            <input type="text" class="search-input" id="search-input" placeholder="–ü–æ–∏—Å–∫ —É—Å–ª—É–≥...">
        </div>
    </div>

    <!-- –¢–∞–±—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div class="tabs-wrap" id="tabs-container">
        <!-- JS -->
    </div>

    <!-- –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ -->
    <div class="list-wrap" id="list-container">
        <!-- JS -->
    </div>

    <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="bottom-panel" id="bottom-panel">
        <div class="total-col">
            <span class="total-lbl">–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞</span>
            <span class="total-val" id="total-price">0 ‚ÇΩ</span>
        </div>
        <button class="order-btn" onclick="openModal()">
            –ö –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é <i class="fa-solid fa-arrow-right"></i>
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal-overlay" id="modal">
        <div class="modal-card">
            <div class="modal-head">
                <div class="modal-title">–í–∞—à –∑–∞–∫–∞–∑ ‚ö°</div>
                <div onclick="closeModal()" style="font-size: 24px; color: var(--tg-hint); cursor: pointer;">&times;</div>
            </div>
            
            <div id="cart-details">
                <!-- –°—é–¥–∞ –ø–æ–ø–∞–¥—É—Ç —Ç–æ–≤–∞—Ä—ã -->
            </div>

            <textarea class="input-area" id="order-comment" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ê–¥—Ä–µ—Å, —Ç–µ–ª–µ—Ñ–æ–Ω, –≤—Ä–µ–º—è)..."></textarea>
            
            <button class="send-btn" onclick="sendOrder()">
                <i class="fa-brands fa-telegram"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
            </button>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–º—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ —Å—Ç–∏–ª–µ–π
    if (tg.colorScheme === 'dark') {
        document.body.classList.add('dark-mode');
    }

    // === –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –£–°–õ–£–ì ===
    const services = [
        {
            id: "finish",
            title: "–ß–∏—Å—Ç–æ–≤–∞—è",
            icon: "fa-plug",
            items: [
                { id: 1, name: "–†–æ–∑–µ—Ç–∫–∞ / –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—å (–≤ –ø–æ–¥—Ä–æ–∑–µ—Ç–Ω–∏–∫)", price: 350, unit: "—à—Ç" },
                { id: 2, name: "–ù–∞–∫–ª–∞–¥–Ω–∞—è —Ä–æ–∑–µ—Ç–∫–∞ (–æ—Ç–∫—Ä—ã—Ç–∞—è)", price: 450, unit: "—à—Ç" },
                { id: 3, name: "–í–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å (1—Ñ/3—Ñ)", price: 1200, unit: "—à—Ç" },
                { id: 4, name: "–î—É—Ö–æ–≤–æ–π —à–∫–∞—Ñ", price: 1000, unit: "—à—Ç" },
                { id: 5, name: "–†–æ–∑–µ—Ç–∫–∞ 380–í (—Å–∏–ª–æ–≤–∞—è)", price: 1500, unit: "—à—Ç" },
                { id: 6, name: "–¢–µ—Ä–º–æ—Ä–µ–≥—É–ª—è—Ç–æ—Ä —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞", price: 600, unit: "—à—Ç" }
            ]
        },
        {
            id: "light",
            title: "–û—Å–≤–µ—â–µ–Ω–∏–µ",
            icon: "fa-lightbulb",
            items: [
                { id: 10, name: "–õ—é—Å—Ç—Ä–∞ (–∫—Ä—é–∫/–ø–ª–∞–Ω–∫–∞)", price: 1500, unit: "—à—Ç" },
                { id: 11, name: "–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ '–ê—Ä–º—Å—Ç—Ä–æ–Ω–≥'", price: 500, unit: "—à—Ç" },
                { id: 12, name: "–¢–æ—á–µ—á–Ω—ã–π —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫", price: 450, unit: "—à—Ç" },
                { id: 13, name: "LED –ª–µ–Ω—Ç–∞ (–≤ –ø—Ä–æ—Ñ–∏–ª—å)", price: 450, unit: "–º" },
                { id: 14, name: "LED –ª–µ–Ω—Ç–∞ (–Ω–∞–∫–ª–µ–π–∫–∞)", price: 300, unit: "–º" },
                { id: 15, name: "–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è / –¥—Ä–∞–π–≤–µ—Ä", price: 800, unit: "—à—Ç" }
            ]
        },
        {
            id: "diag",
            title: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",
            icon: "fa-bolt",
            items: [
                { id: 20, name: "–ü–æ–∏—Å–∫ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏ (–º–∏–Ω. –≤—ã–µ–∑–¥)", price: 3000, unit: "—É—Å–ª." },
                { id: 21, name: "–†–µ–º–æ–Ω—Ç –æ–±—Ä—ã–≤–∞ –≤ —Å—Ç–µ–Ω–µ", price: 1500, unit: "—Ç–æ—á–∫–∞" },
                { id: 22, name: "–ü–µ—Ä–µ–±–æ—Ä–∫–∞ —Ä–∞—Å–ø–∞–µ—á–Ω–æ–π –∫–æ—Ä–æ–±–∫–∏", price: 1200, unit: "—à—Ç" }
            ]
        },
        {
            id: "rough",
            title: "–ß–µ—Ä–Ω–æ–≤—ã–µ",
            icon: "fa-hammer",
            items: [
                { id: 30, name: "–®—Ç—Ä–æ–±–ª–µ–Ω–∏–µ (–±–µ—Ç–æ–Ω)", price: 600, unit: "–º" },
                { id: 31, name: "–®—Ç—Ä–æ–±–ª–µ–Ω–∏–µ (–∫–∏—Ä–ø–∏—á/–±–ª–æ–∫)", price: 400, unit: "–º" },
                { id: 32, name: "–í–º–∞–∑–∫–∞ –ø–æ–¥—Ä–æ–∑–µ—Ç–Ω–∏–∫–∞", price: 350, unit: "—à—Ç" },
                { id: 33, name: "–ü—Ä–æ–∫–ª–∞–¥–∫–∞ –∫–∞–±–µ–ª—è (–≤ –≥–æ—Ñ—Ä–µ)", price: 150, unit: "–º" }
            ]
        },
        {
            id: "shield",
            title: "–©–∏—Ç",
            icon: "fa-server",
            items: [
                { id: 40, name: "–ê–≤—Ç–æ–º–∞—Ç 1–ü", price: 350, unit: "—à—Ç" },
                { id: 41, name: "–£–ó–û / –î–∏—Ñ.–∞–≤—Ç–æ–º–∞—Ç", price: 600, unit: "—à—Ç" },
                { id: 42, name: "–ö—Ä–æ—Å—Å-–º–æ–¥—É–ª—å / –®–∏–Ω—ã", price: 800, unit: "—à—Ç" },
                { id: 43, name: "–ú–æ–Ω—Ç–∞–∂ —Å—á–µ—Ç—á–∏–∫–∞", price: 1500, unit: "—à—Ç" }
            ]
        }
    ];

    let cart = {};

    function init() {
        const tabsCont = document.getElementById('tabs-container');
        const listCont = document.getElementById('list-container');

        services.forEach((cat, idx) => {
            // 1. –°–æ–∑–¥–∞–Ω–∏–µ –¢–∞–±–∞
            const tab = document.createElement('div');
            tab.className = `tab-btn ${idx === 0 ? 'active' : ''}`;
            tab.innerHTML = `<i class="fa-solid ${cat.icon}"></i> ${cat.title}`;
            tab.onclick = () => {
                document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`cat-${cat.id}`).scrollIntoView({ behavior: 'smooth', block: 'start' });
            };
            tabsCont.appendChild(tab);

            // 2. –°–æ–∑–¥–∞–Ω–∏–µ –ë–ª–æ–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const catBlock = document.createElement('div');
            catBlock.className = 'category-block';
            catBlock.id = `cat-${cat.id}`;
            catBlock.innerHTML = `<div class="cat-title">${cat.title}</div>`;

            cat.items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'item-card';
                itemEl.id = `card-${item.id}`;
                itemEl.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div>
                            <span class="item-price">${item.price} ‚ÇΩ</span> 
                            <span class="item-unit">/ ${item.unit}</span>
                        </div>
                    </div>
                    <div id="ctrl-${item.id}">
                        <div class="add-btn" onclick="update(${item.id}, 1)">–î–æ–±–∞–≤–∏—Ç—å</div>
                    </div>
                `;
                catBlock.appendChild(itemEl);
            });

            listCont.appendChild(catBlock);
        });
    }

    // === –õ–û–ì–ò–ö–ê ===
    window.update = function(id, delta) {
        // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ (—Ç–æ–ª—å–∫–æ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
        if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');

        if (!cart[id]) cart[id] = 0;
        cart[id] += delta;
        if (cart[id] <= 0) delete cart[id];

        renderCtrl(id);
        renderTotal();
    }

    function renderCtrl(id) {
        const ctrlDiv = document.getElementById(`ctrl-${id}`);
        const cardDiv = document.getElementById(`card-${id}`);
        const qty = cart[id] || 0;

        if (qty === 0) {
            ctrlDiv.innerHTML = `<div class="add-btn" onclick="update(${id}, 1)">–î–æ–±–∞–≤–∏—Ç—å</div>`;
            cardDiv.classList.remove('has-qty');
        } else {
            ctrlDiv.innerHTML = `
                <div class="ctrl">
                    <button class="ctrl-btn" onclick="update(${id}, -1)">‚àí</button>
                    <div class="ctrl-val">${qty}</div>
                    <button class="ctrl-btn" onclick="update(${id}, 1)">+</button>
                </div>
            `;
            cardDiv.classList.add('has-qty');
        }
    }

    function renderTotal() {
        let total = 0;
        services.forEach(cat => cat.items.forEach(i => {
            if (cart[i.id]) total += cart[i.id] * i.price;
        }));

        const panel = document.getElementById('bottom-panel');
        const priceEl = document.getElementById('total-price');

        if (total > 0) {
            panel.classList.add('visible');
            priceEl.innerText = total.toLocaleString('ru-RU') + ' ‚ÇΩ';
        } else {
            panel.classList.remove('visible');
        }
    }

    // === –ú–û–î–ê–õ–ö–ê –ò –û–¢–ü–†–ê–í–ö–ê ===
    window.openModal = function() {
        const modal = document.getElementById('modal');
        const content = document.getElementById('cart-details');
        modal.classList.add('active');
        
        // –†–µ–Ω–¥–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏
        let html = '';
        let total = 0;
        services.forEach(cat => {
            cat.items.forEach(item => {
                if (cart[item.id]) {
                    const sum = cart[item.id] * item.price;
                    total += sum;
                    html += `
                    <div class="cart-row">
                        <div style="flex:1; padding-right:10px;">
                            ${item.name} <br>
                            <span style="color:var(--tg-hint); font-size:12px;">${cart[item.id]} ${item.unit} x ${item.price}</span>
                        </div>
                        <div style="font-weight:700;">${sum} ‚ÇΩ</div>
                    </div>`;
                }
            });
        });
        html += `<div style="text-align:right; font-size:18px; font-weight:800; margin-top:15px; border-top:1px solid var(--tg-sec-bg); padding-top:10px;">–ò—Ç–æ–≥–æ: ${total.toLocaleString()} ‚ÇΩ</div>`;
        content.innerHTML = html;
    }

    window.closeModal = function() {
        document.getElementById('modal').classList.remove('active');
    }

    window.sendOrder = function() {
        const comment = document.getElementById('order-comment').value;
        const myUsername = "Llosta"; // <--- –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô –Æ–ó–ï–†–ù–ï–ô–ú (–±–µ–∑ @)

        let msg = "‚ö° –ó–∞–∫–∞–∑ (Mini App):\n\n";
        let total = 0;

        services.forEach(cat => {
            cat.items.forEach(item => {
                if (cart[item.id]) {
                    const sum = cart[item.id] * item.price;
                    total += sum;
                    msg += `‚ñ´Ô∏è ${item.name}: ${cart[item.id]} ${item.unit} (${sum}‚ÇΩ)\n`;
                }
            });
        });

        msg += `\nüí∞ –ò–¢–û–ì–û: ${total.toLocaleString()} —Ä—É–±.`;
        if (comment) msg += `\n\nüìù –ö–æ–º–º–µ–Ω—Ç: ${comment}`;

        const url = `https://t.me/${myUsername}?text=${encodeURIComponent(msg)}`;
        
        tg.close();
        tg.openTelegramLink(url);
    }

    // === –ü–û–ò–°–ö ===
    document.getElementById('search-input').addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        document.querySelectorAll('.item-card').forEach(card => {
            const text = card.querySelector('.item-name').innerText.toLowerCase();
            if (text.includes(val)) {
                card.style.display = 'flex';
            } else {
                card.style.display = 'none';
            }
        });
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        document.querySelectorAll('.category-block').forEach(block => {
            const visibleItems = block.querySelectorAll('.item-card[style="display: flex;"]');
            // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –ø—É—Å—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—ë, –∏–Ω–∞—á–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            if (val === '') block.style.display = 'block';
            else block.style.display = visibleItems.length > 0 ? 'block' : 'none';
        });
    });

    init();

</script>
</body>
</html>
